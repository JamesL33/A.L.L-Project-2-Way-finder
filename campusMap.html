<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="static/css/campusMap.css">
  
  <title>Campus Map</title>
  <script src="https://maps.google.com/maps/api/js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="static/js/gmaps.js"></script> 
</head>
<body>
  <script src="static/js/markers.js"></script>
      <div class="menu-wrap">
          <nav class="menu">
            <div class="icon-list"><br>
                  <!-- Button Declarations -->
                  <center><img src="static/images/covUniLogoFinal.png" alt="" width="200" height="60" class="menu-image"/></center><br>
                  	<a href="about"><em class=""></em><span>About</span></a> <br>
					<a href="ecBuildingNav"><em class=""></em><span>EEC Building Navigation</span></a> <br>
					<a href="campusMap"><em class=""></em><span>Campus Navigation</span></a> <br>
					<a href="covUniBuildings"><em class=""></em><span>Buildings on Campus</span></a> <br>
					<a href="admin"><em class=""></em><span>Administration</span></a> <br><br>
                  
                   <center><form action="campusMap">
						<table>
							<tbody><tr><th align="center"><font color = "white">From: </font></th><td>
							<br>
								<select id="list1">
									<option value="">My current GPS location</option>
								</select><br><br>
								</td></tr><tr><th><font color = "white">To: </font></th><td>
								<select id="list2">
								</select>
								</td></tr>
                                </tbody></table>
                                <br>
                            	<br>
							<a href="#" id="start_travel" class="test-box"><font color = "black">GO</font></a>
                        </form></center>  
                    </form></center>                  
              </div>
          </nav>
      <button class="close-button" id="close-button"></button>
      </div>
	<button class="menu-button" id="open-button"></button>
	<script type="text/javascript" src="static/js/main.js"></script>

  <div id="map"></div>
  <div id="selection" style="overflow-y: scroll; ">    
  	<ol class="centering" id="list_of_directions"></ol>    
  </div>
  <script>
  	/*
	This script uses gmaps.js and its examples from this website here:
	https://hpneo.github.io/gmaps/
	https://hpneo.github.io/gmaps/examples/routes_advanced.html
  	*/

	//List1 and List2 can be editied via these variables
  	var list1 = document.getElementById('list1');
  	var list2 = document.getElementById('list2');

  	//Goes through every location and places them inside the drop down boxes.
  	for(index in locations)
  	{
    	list1.options[list1.options.length] = new Option(locations[index], index);
    	list2.options[list2.options.length] = new Option(locations[index], index);
	}

	//Using the GMAPS.js inbuilt geolocation tool
	GMaps.geolocate({

		//If successful then this function will run with your current lat/long
		success: function(position) {
    		//Storing users lat/long
        	var myLat = position.coords.latitude;
        	var myLong = position.coords.longitude;
			
			//creates a new map with GMAPS
        	var map = new GMaps({
        		el: '#map',
        		lat: myLat, 
        		lng: myLong,
        		zoom: 17,
				disableDefaultUI: true
        	});

			//This iterates over the locations and adds a marker for each.
        	var counter = 0;
        	for(index in locations)
        	{
        		var new_marker = Object.keys(locations)[counter].split(" ");
        		createMarker(new_marker[0], new_marker[1], map, locations[Object.keys(locations)[counter]]);
        		counter += 1;
        	}

			//JQuery used to link the button to this function
        	$('#start_travel').click(function(e){

				//creates a new map with GMAPS
        		var map = new GMaps({
        	    	el: '#map',
        	    	lat: myLat, 
        	    	lng: myLong,
        	    	zoom: 17,
					disableDefaultUI: true
        		});

        		//This iterates over the locations and adds a marker for each.
        		var counter = 0;
        		for(index in locations)
        		{
        			var new_marker = Object.keys(locations)[counter].split(" ")
        			createMarker(new_marker[0], new_marker[1], map, locations[Object.keys(locations)[counter]]);
        			counter += 1;        	
        		}
        		//
        		$('#list_of_directions').empty();
        		
        		var current_location = document.getElementById("list1");
        		var destination = document.getElementById("list2");
    			var location = current_location.options[current_location.selectedIndex].value.split(" ");
    			var selectedDestination = destination.options[destination.selectedIndex].value.split(" ");
				
    			if(location == "") //if you select my GPS location
    			{
    				location = [myLat, myLong]
    				createMarker(myLat, myLong, map, "You are here!")
    			}
				
        		e.preventDefault();
        		map.travelRoute({
        		  	origin: location,
        		  	destination: selectedDestination,
        		  	travelMode: 'walking',  
        		  	step: function(e){
        		   		$('#list_of_directions').append('<li>'+e.instructions+'</li>');
        		   		$('#list_of_directions li:eq('+e.step_number+')').delay(450*e.step_number).fadeIn(200, function(){
        		       		map.setCenter(e.end_location.lat()+0.00110, e.end_location.lng());
        		       		map.drawPolyline({
        		           		path: e.path,
        		          		strokeColor: '#0033cc',
        		          		strokeOpacity: 0.4,
        		          		strokeWeight: 6
        		       		});
        		       	});
        		   	}
        		});            	     	
        	});
      	},
      	error: function(error) {
        alert('Geolocation failed: '+error.message);
      	},
      	not_supported: function() {
        alert("Your browser does not support geolocation");
      	}
    });
  </script>
</body>
</html>