<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="static/css/campusMap.css">
  <title></title>
  <script src="http://maps.google.com/maps/api/js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="static/js/gmaps.js"></script>
</head>
<body>
  <div id="map"></div>
  <div id="selection">
  	<select id="destinations">
  		<option value="52.405482 -1.501099">Engineering Building</option>
  		<option value="52.408635 -1.496508">Home</option>
	</select>
	<a href="#" id="start_travel">GO</a>
    <ul id="instructions">
    </ul>
  </div>
  <script>
    var engineeringCenter = [52.405482, -1.501099];
    var home = [52.408635, -1.496508];   

    GMaps.geolocate({
    	success: function(position) {
          var myLat = position.coords.latitude;
          var myLong = position.coords.longitude;

          var map = new GMaps({
            el: '#map',
            lat: myLat, 
            lng: myLong,
            zoom: 17
          });

        $('#start_travel').click(function(e){
        	$('#instructions').empty();
        	var dest = document.getElementById("destinations");
    		var selectedDestination = dest.options[dest.selectedIndex].value.split(" ");
        	e.preventDefault();
        	map.travelRoute({
          	  origin: [myLat, myLong],
          	  destination: selectedDestination,
          	  travelMode: 'walking',  
          	  step: function(e){
                $('#instructions').append('<li>'+e.instructions+'</li>');
                $('#instructions li:eq('+e.step_number+')').delay(450*e.step_number).fadeIn(200, function(){
                  map.setCenter(e.end_location.lat()+0.00110, e.end_location.lng());
                  map.drawPolyline({
                    path: e.path,
          	        strokeColor: '#0033cc',
          	        strokeOpacity: 0.4,
          	        strokeWeight: 6
                  });
                });
              }
          	});
        });
      },
      error: function(error) {
        alert('Geolocation failed: '+error.message);
      },
      not_supported: function() {
        alert("Your browser does not support geolocation");
      }
    });
  </script>
</body>
</html>